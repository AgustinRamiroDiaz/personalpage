<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="Modern, pretty, and clean theme." name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><link href=https://agustinramirodiaz.github.io/blog/docker-file-permissions/ rel=canonical><title>Understanding Linux file permissions in Docker containers - Agustín Ramiro Díaz</title><link href=https://agustinramirodiaz.github.io/style.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=/syntax-theme-dark.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=/syntax-theme-light.css rel=stylesheet><style>:root {--primary-color-alpha:rgba(255,120,0,.2);--primary-color:#ff7800}</style><link href=https://agustinramirodiaz.github.io/favicon.png rel=icon type=image/png><link href=https://agustinramirodiaz.github.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link href=https://mstdn.social/@agustinramirodiaz rel=me><meta content="Agustín Ramiro Díaz" property=og:site_name><meta content="Understanding Linux file permissions in Docker containers - Agustín Ramiro Díaz" property=og:title><meta content=https://agustinramirodiaz.github.io/blog/docker-file-permissions/ property=og:url><meta property=og:description><meta content=https://agustinramirodiaz.github.io/card.png property=og:image><meta content=summary_large_image property=twitter:card><body><header id=site-nav><nav><a href=#main id=main-content tabindex=0>Skip to main content</a><ul><li id=home><a href=https://agustinramirodiaz.github.io>Agustín Ramiro Díaz</a><li><a href=https://agustinramirodiaz.github.io/blog>Blog</a><li><a href=https://github.com/AgustinRamiroDiaz>GitHub</a><li><a href=https://www.linkedin.com/in/agust%C3%ADn-ramiro-d%C3%ADaz-bb0387184/>LinkedIn</a><li><a href=mailto:agustin.ramiro.diaz@gmail.com>Contact</a><li id=feed><a href=https://agustinramirodiaz.github.io/atom.xml> <svg viewbox="0 0 16 16" fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><path d="M1.988 1.988V3c.008.547.453.984 1 .988.004-.004.008-.004.012-.004v.028A8.977 8.977 0 0 1 11.988 13a.991.991 0 0 0 1 .984h1V13h-.004c0-.004 0-.004.004-.008C13.984 7.02 9.184 2.148 3.242 2.02A1.004 1.004 0 0 0 3 1.988v-.004zm0 4V7c.008.547.453.984 1 .988.004-.004.008-.004.012-.004V8a4.985 4.985 0 0 1 4.996 4.844 1.002 1.002 0 0 0 .988 1.145c.008-.005.012-.005.016-.005v.004h.984V13H10c0-3.793-3.047-6.898-6.82-6.992 0-.004-.004-.004-.004-.004A.892.892 0 0 0 3 5.988v-.004zm2 4a1.999 1.999 0 1 0-.002 3.998 1.999 1.999 0 0 0 .002-3.998m0 0"/></svg> <span>Feed</span> </a><li id=toggle-dark-light-theme><a class=navbaricon> <svg viewbox="0 0 48 48" fill=currentColor height=16 width=16 xmlns=http://www.w3.org/2000/svg><path d="M 23.976562 3.9785156 A 1.50015 1.50015 0 0 0 22.5 5.5 L 22.5 8.5 A 1.50015 1.50015 0 1 0 25.5 8.5 L 25.5 5.5 A 1.50015 1.50015 0 0 0 23.976562 3.9785156 z M 10.902344 9.4042969 A 1.50015 1.50015 0 0 0 9.8574219 11.980469 L 11.978516 14.101562 A 1.5012202 1.5012202 0 0 0 14.101562 11.978516 L 11.980469 9.8574219 A 1.50015 1.50015 0 0 0 10.902344 9.4042969 z M 37.050781 9.4042969 A 1.50015 1.50015 0 0 0 36.019531 9.8574219 L 33.898438 11.978516 A 1.5012202 1.5012202 0 0 0 36.021484 14.101562 L 38.142578 11.980469 A 1.50015 1.50015 0 0 0 37.050781 9.4042969 z M 24 13 C 17.942632 13 13 17.942636 13 24 C 13 30.057364 17.942632 35 24 35 C 30.057368 35 35 30.057364 35 24 C 35 17.942636 30.057368 13 24 13 z M 24 16 C 28.436049 16 32 19.563954 32 24 C 32 28.436046 28.436049 32 24 32 C 19.563951 32 16 28.436046 16 24 C 16 19.563954 19.563951 16 24 16 z M 5.5 22.5 A 1.50015 1.50015 0 1 0 5.5 25.5 L 8.5 25.5 A 1.50015 1.50015 0 1 0 8.5 22.5 L 5.5 22.5 z M 39.5 22.5 A 1.50015 1.50015 0 1 0 39.5 25.5 L 42.5 25.5 A 1.50015 1.50015 0 1 0 42.5 22.5 L 39.5 22.5 z M 13.009766 33.445312 A 1.50015 1.50015 0 0 0 11.978516 33.898438 L 9.8574219 36.019531 A 1.501221 1.501221 0 1 0 11.980469 38.142578 L 14.101562 36.021484 A 1.50015 1.50015 0 0 0 13.009766 33.445312 z M 34.943359 33.445312 A 1.50015 1.50015 0 0 0 33.898438 36.021484 L 36.019531 38.142578 A 1.5012209 1.5012209 0 1 0 38.142578 36.019531 L 36.021484 33.898438 A 1.50015 1.50015 0 0 0 34.943359 33.445312 z M 23.976562 37.978516 A 1.50015 1.50015 0 0 0 22.5 39.5 L 22.5 42.5 A 1.50015 1.50015 0 1 0 25.5 42.5 L 25.5 39.5 A 1.50015 1.50015 0 0 0 23.976562 37.978516 z"></path></svg> </a></ul></nav></header><style>:root {
    --bg: {
        {
        config.extra.style.bg_color | default(value="#f4f4f5")
      }
    }

    ;

    --bg-dark: {
        {
        config.extra.style.bg_dark_color | default(value="#18181b")
      }
    }

    ;

    --header: {
        {
        config.extra.style.header_color | default(value="#e4e4e7")
      }
    }

    ;

    --header-dark: {
        {
        config.extra.style.header_dark_color | default(value="#27272a")
      }
    }

    ;
  }</style><script>const darkKey="dark";const setDark=a=>{localStorage.setItem(darkKey,a);if(!a){document.documentElement.style.setProperty("--bg-color","var(--bg-color-l)");document.documentElement.style.setProperty("--fg-color","var(--fg-color-l)");document.documentElement.style.setProperty("--fg-muted-1","var(--fg-muted-1-l)");document.documentElement.style.setProperty("--fg-muted-2","var(--fg-muted-2-l)");document.documentElement.style.setProperty("--fg-muted-3","var(--fg-muted-3-l)");document.documentElement.style.setProperty("--fg-muted-4","var(--fg-muted-4-l)");document.documentElement.style.setProperty("--fg-muted-5","var(--fg-muted-5-l)");document.documentElement.style.setProperty("--nav-bg","var(--nav-bg-l)");document.documentElement.style.setProperty("--orange-bg","var(--orange-bg-l)");document.documentElement.style.setProperty("--orange-fg","var(--orange-fg-l)");document.documentElement.style.setProperty("--purple-bg","var(--purple-bg-l)");document.documentElement.style.setProperty("--purple-fg","var(--purple-fg-l)");document.documentElement.style.setProperty("--red-bg","var(--red-bg-l)");document.documentElement.style.setProperty("--red-fg","var(--red-fg-l)");document.documentElement.style.setProperty("--yellow-bg","var(--yellow-bg-l)");document.documentElement.style.setProperty("--yellow-fg","var(--yellow-fg-l)")}else{document.documentElement.style.setProperty("--bg-color","var(--bg-color-d)");document.documentElement.style.setProperty("--fg-color","var(--fg-color-d)");document.documentElement.style.setProperty("--fg-muted-1","var(--fg-muted-1-d)");document.documentElement.style.setProperty("--fg-muted-2","var(--fg-muted-2-d)");document.documentElement.style.setProperty("--fg-muted-3","var(--fg-muted-3-d)");document.documentElement.style.setProperty("--fg-muted-4","var(--fg-muted-4-d)");document.documentElement.style.setProperty("--fg-muted-5","var(--fg-muted-5-d)");document.documentElement.style.setProperty("--nav-bg","var(--nav-bg-d)");document.documentElement.style.setProperty("--orange-bg","var(--orange-bg-d)");document.documentElement.style.setProperty("--orange-fg","var(--orange-fg-d)");document.documentElement.style.setProperty("--purple-bg","var(--purple-bg-d)");document.documentElement.style.setProperty("--purple-fg","var(--purple-fg-d)");document.documentElement.style.setProperty("--red-bg","var(--red-bg-d)");document.documentElement.style.setProperty("--red-fg","var(--red-fg-d)");document.documentElement.style.setProperty("--yellow-bg","var(--yellow-bg-d)");document.documentElement.style.setProperty("--yellow-fg","var(--yellow-fg-d)")}};const darkScheme=window.matchMedia("(prefers-color-scheme: dark)");const darkVal=localStorage.getItem(darkKey);setDark(darkVal?darkVal==="true":darkScheme.matches);darkScheme.addEventListener("change",a=>{setDark(a.matches)});const btnDark=document.getElementById("toggle-dark-light-theme");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem(darkKey)!=="true")})</script><div class=container id=main><h1>Understanding Linux file permissions in Docker containers</h1><small> <time datetime=2024-02-10T00:00:00+00:00 pubdate>10 February 2024</time> <span>•</span> <span>Author: Agustín Ramiro Díaz</span> <span>•</span> <ul class=tags><li><a class=tag href=https://agustinramirodiaz.github.io/tags/docker/>Docker</a><li><a class=tag href=https://agustinramirodiaz.github.io/tags/containers/>Containers</a><li><a class=tag href=https://agustinramirodiaz.github.io/tags/linux/>Linux</a></ul> </small><h2>Table of Contents</h2><ul><li><a href=https://agustinramirodiaz.github.io/blog/docker-file-permissions/#motivation>Motivation</a><li><a href=https://agustinramirodiaz.github.io/blog/docker-file-permissions/#understanding-file-permissions>Understanding file permissions</a> <ul><li><a href=https://agustinramirodiaz.github.io/blog/docker-file-permissions/#file-permissions-in-linux>File permissions in Linux</a><li><a href=https://agustinramirodiaz.github.io/blog/docker-file-permissions/#file-permissions-in-docker-containers>File permissions in Docker containers</a></ul><li><a href=https://agustinramirodiaz.github.io/blog/docker-file-permissions/#surrealdb-issue>SurrealDB issue</a> <ul><li><a href=https://agustinramirodiaz.github.io/blog/docker-file-permissions/#the-twist>The twist</a><li><a href=https://agustinramirodiaz.github.io/blog/docker-file-permissions/#going-a-bit-deeper>Going a bit deeper</a></ul><li><a href=https://agustinramirodiaz.github.io/blog/docker-file-permissions/#conclusion>Conclusion</a></ul><h1 id=motivation>Motivation</h1><p>I recently wanted to work in the <a href=https://github.com/surrealdb/surrealdb rel=noopener target=_blank>surrealdb</a> codebase, and by looking at its issues I’ve found <a href=https://github.com/surrealdb/surrealdb/issues/3468 rel=noopener target=_blank>one related to file permissions in Docker</a>. I remember having some vague knowledge about issues with file permissions before, and I thought it would be a good time to clear my doubts.<h1 id=understanding-file-permissions>Understanding file permissions</h1><h2 id=file-permissions-in-linux>File permissions in Linux</h2><p>I won’t go into too much detail because there are <a href=https://linuxhandbook.com/linux-file-permissions/ rel=noopener target=_blank>great resources</a> that explain this better than me. Heres’s a brief summary:<p>In Linux, file permissions are managed by the kernel. Each file has an owner, a group, and a set of permissions. The owner is the user who created the file, and the group is a set of users who have the same permissions over the file. The permissions are divided into three categories: read, write, and execute. Each category has three possible values: allowed, denied, and not set. The permissions are represented by a 9-character string, where the first three characters represent the owner’s permissions, the next three characters represent the group’s permissions, and the last three characters represent the permissions for everyone else.<p>This permissions are usually handled with numbers or leters when running commands like <code>chmod</code>. The numbers are octal, and the letters are <code>r</code> for read, <code>w</code> for write, and <code>x</code> for execute. The numbers are calculated by adding the values of the permissions: 4 for read, 2 for write, and 1 for execute. For example, if we want to give read and write permissions to the owner, and read permissions to the group and everyone else, we would run <code>chmod 644 file.txt</code>. This would set the permissions to <code>-rw-r--r--</code>. We can also use the letters to set the permissions, for example, <code>chmod u+x file.txt</code> would add the execute permission to the owner.<h2 id=file-permissions-in-docker-containers>File permissions in Docker containers</h2><p>Docker containers are isolated environments, but they still run on top of the host’s kernel. This means that the file permissions are managed by the host’s kernel, and the container’s kernel is not involved in this process. This is important to understand because it means that the file permissions inside the container are the same as the file permissions on the host. This can lead to issues for example when the container and the host have different users and groups.<p>By default, the container user is set to <code>root</code> with uid and gid 0. This means that if we create a file inside the container, <code>root</code> will be the owner of the file. This can lead to issues when we try to access the file from the host, because the host’s user might not have the same uid as the container’s <code>root</code>. This can be solved by using the <code>--user</code> flag when running the container, which allows us to specify the uid and gid of the container’s user. This way, we can make sure that the container’s user has the same uid and gid as the host’s user.<p>Example with default <code>root</code> user:<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> run a container which creates a file</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>rm</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span> <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">pwd</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>:/app alpine sh<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>touch /app/file.txt<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> check the file permissions</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ls<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>l</span> file.txt</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">-rw-r--r--</span></span><span class="z-meta z-function-call z-arguments z-shell"> 1 root root 0 Feb 10 16:39 file.txt</span>
</span></code></pre><p>Example with custom user:<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> if you are following along, you'll need to delete the file generated previously</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> sudo rm file.txt</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> run a container which creates a file with the current user. $(id -u) and $(id -g) are used to get the current user's uid and gid</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>rm</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span> <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">pwd</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>:/app<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>user</span> <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">id</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>u</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>:<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">id</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>g</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span> alpine sh<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>touch /app/file.txt<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ls<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>l</span> file.txt</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">-rw-r--r--</span></span><span class="z-meta z-function-call z-arguments z-shell"> 1 <span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>YOUR_USERNAME<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>YOUR_GROUP<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">0</span> Feb 10 16:41 file.txt</span>
</span></code></pre><h1 id=surrealdb-issue>SurrealDB issue</h1><p><a href=https://github.com/surrealdb/surrealdb/issues/3468 rel=noopener target=_blank>This issue</a> commented a problem with file permissions when running the container. Here’s the excerpt:<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>rm</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>pull</span> always<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> 8000:8000<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span> /mydata:/mydata surrealdb/surrealdb:latest start file:/mydata/mydatabase.db</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-09T13:41:36.643952Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  INFO surreal::env: Running 1.1.1+20240116.b261047 for linux on x86_64</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-09T13:41:36.643985Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  WARN surreal::dbs: ❌🔒 IMPORTANT: Authentication is disabled. This is not recommended for production use. 🔒❌</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-09T13:41:36.644012Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  INFO surrealdb::kvs::ds: Starting kvs store at file:///mydata/mydatabase.db</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-09T13:41:36.645252Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  INFO surrealdb::kvs::ds: Started kvs store at file:///mydata/mydatabase.db</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-09T13:41:36.645267Z</span></span><span class="z-meta z-function-call z-arguments z-shell"> ERROR surreal::cli: There was a problem with the database: There was a problem with a datastore transaction: Failed to create RocksDB directory: <span class="z-meta z-group z-expansion z-command z-backticks z-shell"><span class="z-punctuation z-section z-group z-begin z-shell">`</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Os</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> code: 13<span class="z-punctuation z-separator z-shell">,</span> kind: PermissionDenied<span class="z-punctuation z-separator z-shell">,</span> message: <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Permission denied<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-punctuation z-section z-group z-end z-shell">`</span></span>.</span>
</span></code></pre><p>The problem here is that the container is trying to create a file inside the <code>/mydata</code> directory, but it doesn’t have the permissions to do so. To know exactly what the problem is, we would need to know the permissions of the <code>/mydata</code> directory on the host, and the user used in the container.<p>Checking out the permissions of the <code>/mydata</code> directory is easy<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> run the container, expect it to fail as the user mentioned</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>rm</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>pull</span> always<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> 8000:8000<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span> /mydata:/mydata surrealdb/surrealdb:latest start file:/mydata/mydatabase.db</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> check the permissions of the /mydata directory</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ls<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>la</span> /mydata</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">total</span></span><span class="z-meta z-function-call z-arguments z-shell"> 8</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">drwxr-xr-x</span></span><span class="z-meta z-function-call z-arguments z-shell">  2 root root 4096 Feb 10 16:59 ./</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">drwxr-xr-x</span></span><span class="z-meta z-function-call z-arguments z-shell"> 20 root root 4096 Feb 10 16:59 ../</span>
</span></code></pre><p>Here we can see that the <code>/mydata</code> directory is owned by <code>root</code>, and it has read, write, and execute permissions for the owner, and read and execute permissions for the group and execute for everyone else. This means that the container needs to run as <code>root</code> in order to create files inside the <code>/mydata</code> directory. Let’s test that out:<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>rm</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>pull</span> always<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>user</span> root<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> 8000:8000<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span> /mydata:/mydata surrealdb/surrealdb:latest start file:/mydata/mydatabase.db</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">latest:</span></span><span class="z-meta z-function-call z-arguments z-shell"> Pulling from surrealdb/surrealdb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Digest:</span></span><span class="z-meta z-function-call z-arguments z-shell"> sha256:7d00d1b15ccfefdd744c3640122b76fc56eb7dc06d6eebfa3728a28eb1bbaa69</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Status:</span></span><span class="z-meta z-function-call z-arguments z-shell"> Image is up to date for surrealdb/surrealdb:latest</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">.d8888b.</span></span><span class="z-meta z-function-call z-arguments z-shell">                                             888 8888888b.  888888b.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">d88P</span></span><span class="z-meta z-function-call z-arguments z-shell">  Y88b                                            888 888  <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>Y88b 888  <span class="z-punctuation z-definition z-string z-end z-shell">'</span></span>88b</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Y88b.</span></span><span class="z-meta z-function-call z-arguments z-shell">                                                 888 888    888 888  .88P</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>Y888b.   888  888 888d888 888d888  .d88b.   8888b.  888 888    888 8888888K.
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-string z-quoted z-single z-shell">    <span class="z-punctuation z-definition z-string z-end z-shell">'</span></span>Y88b.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 888  888 888P<span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>   888P<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span>   d8P  Y8b     <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>88b 888 888    888 888  <span class="z-punctuation z-definition z-string z-end z-shell">'</span></span>Y88b</span>
</span><span class="z-source z-shell z-bash">      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>888 888  888 888     888     88888888 .d888888 888 888    888 888    888
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-string z-quoted z-single z-shell">Y88b  d88P Y88b 888 888     888     Y8b.     888  888 888 888  .d88P 888   d88P
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-string z-quoted z-single z-shell"> <span class="z-punctuation z-definition z-string z-end z-shell">'</span></span>Y8888P<span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>   <span class="z-punctuation z-definition z-string z-end z-shell">'</span></span>Y88888</span></span><span class="z-meta z-function-call z-arguments z-shell"> 888     888      <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>Y8888  <span class="z-punctuation z-definition z-string z-end z-shell">'</span></span>Y888888 888 8888888P<span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>  8888888P<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-10T20:01:53.012007Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  INFO surreal::env: Running 1.1.1+20240116.b261047 for linux on x86_64</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-10T20:01:53.012027Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  WARN surreal::dbs: ❌🔒 IMPORTANT: Authentication is disabled. This is not recommended for production use. 🔒❌</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-10T20:01:53.012041Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  INFO surrealdb::kvs::ds: Starting kvs store at file:///mydata/mydatabase.db</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-10T20:01:53.063538Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  INFO surrealdb::kvs::ds: Started kvs store at file:///mydata/mydatabase.db</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-10T20:01:53.063729Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  INFO surrealdb::node: Started node agent</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-10T20:01:53.064001Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  INFO surrealdb::net: Started web server on 0.0.0.0:8000</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">^C2024-02-10T20:01:56.798021Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  INFO surrealdb::net: SIGINT received. Waiting for graceful shutdown... A second signal will force an immediate shutdown</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-10T20:01:56.798094Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  INFO surrealdb::node: Gracefully stopping node agent</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-10T20:01:56.798101Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  INFO surrealdb::node: Stopped node agent</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-10T20:01:56.798124Z</span></span><span class="z-meta z-function-call z-arguments z-shell">  INFO surrealdb::net: Web server stopped. Bye!</span>
</span></code></pre><p>The container ran successfully as root!<h2 id=the-twist>The twist</h2><p>You might be asking yourself <em>Isn’t there an alternative to running the container as root?</em>. The answer is yes! and we need to take a closer look at our <code>/mydata</code> directory in our host machine. Do you remember creating it? No! That’s because the docker daemon created it for you when you ran <code>docker run -v ...</code>. By default, docker will create the folder with <code>root</code> user and group. We can change this by previously creating the folder with the correct user and group.<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> if you are following along, you'll want to delete the folder generated previously</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> sudo rm<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>rf</span> /mydata</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Since / is owned by root, I suggest we use our current folder to store the data</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> mkdir ./mydata</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Check that the folder is owned by your current user</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ls<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>la</span> ./mydata</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">total</span></span><span class="z-meta z-function-call z-arguments z-shell"> 8</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">drwxrwxr-x</span></span><span class="z-meta z-function-call z-arguments z-shell">  2 <span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>YOUR_USERNAME<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>YOUR_GROUP<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">4096</span> Feb 10 17:08 ./</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">drwxrwxr-x</span></span><span class="z-meta z-function-call z-arguments z-shell"> 10 <span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>YOUR_USERNAME<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>YOUR_GROUP<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">4096</span> Feb 10 17:08 ../</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> run the container without root</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>rm</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>pull</span> always<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> 8000:8000<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span> <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">pwd</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>/mydata:/mydata surrealdb/surrealdb:latest start file:/mydata/mydatabase.db</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> various logs</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2024-02-10T20:10:25.453868Z</span></span><span class="z-meta z-function-call z-arguments z-shell"> ERROR surreal::cli: There was a problem with the database: There was a problem with a datastore transaction: Failed to create RocksDB directory: <span class="z-meta z-group z-expansion z-command z-backticks z-shell"><span class="z-punctuation z-section z-group z-begin z-shell">`</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Os</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> code: 13<span class="z-punctuation z-separator z-shell">,</span> kind: PermissionDenied<span class="z-punctuation z-separator z-shell">,</span> message: <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Permission denied<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-punctuation z-section z-group z-end z-shell">`</span></span>.</span>
</span></code></pre><p>But wait, I got an error! That’s because the container is not running with the same user and group as the host. We can fix this by running the container with the same user and group as the host.<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>rm</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>pull</span> always<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>user</span> <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">id</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>u</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>:<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">id</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>g</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> 8000:8000<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span> <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">pwd</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>/mydata:/mydata surrealdb/surrealdb:latest start file:/mydata/mydatabase.db</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> happy logs :D</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre><h2 id=going-a-bit-deeper>Going a bit deeper</h2><p>If you’ve got experience with Docker, you might be thinking that it’s weird that you havent’ gotten to this problem earlier with other containers. There are 2 reasons for this:<ul><li>usually, containers run with <code>root</code> user, giving the container full access over your files<li>when the containers run with a different user, they usually run with the default user that has the same uid and gid as the host’s user (<code>1000:1000</code> in unix systems)</ul><p>The problem in the <code>surrealdb</code> image is that it doesn’t follow the second point. We can check what user and group the container is running with by running the <code>id</code> command inside the container. We can do this by creating a new Dockerfile that copies the <code>id</code> command from a busybox image and running it inside the container.<pre class="language-Dockerfile z-code" data-lang=Dockerfile><code class=language-Dockerfile data-lang=Dockerfile><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> file name: Dockerfile
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">FROM</span> surrealdb/surrealdb:<span class="z-entity z-name z-enum z-tag-digest">latest</span>
</span><span class="z-source z-dockerfile">
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Install shell and utilities, like the `id` command
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> --from=<span class="z-variable z-stage-name">busybox:1.35.0-uclibc</span> /bin/* /bin/
</span></code></pre><p>Then we build the image and run the <code>id</code> command inside the container with <code>-u</code> and <code>-g</code> flags to get the user and group.<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker build .<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> surreal</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>ti</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>entrypoint</span> id surreal<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>u</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">65532</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>ti</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>entrypoint</span> id surreal<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>g</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">65532</span></span>
</span></code></pre><p>The <code>surrealdb</code> container is running with user and group <code>65532:65532</code>. If we were to create another image and add <code>USER 1000</code> to the Dockerfile, we wouldn’t need to specify the <code>--user</code> flag when running the container (if we are using the default <code>1000:1000</code> user in the host).<h1 id=conclusion>Conclusion</h1><p>In this post, we’ve learned about file permissions in Linux and Docker containers. We’ve seen how the file permissions are managed by the host’s kernel, and how the container’s user can affect the file permissions. We’ve also seen how to solve file permission issues by running the container with the correct user and group. I hope this post has been helpful, and that you now have a better understanding of file permissions in Docker containers<hr><nav id=post-nav><a class="post-nav-item post-nav-prev" href=https://agustinramirodiaz.github.io/blog/gh-action-get-pages-url/> <div class=nav-arrow>← Previous</div> <span class=post-title>Dinamically get the URL of a GitHub Pages site in a GitHub Action</span> </a></nav><p class=dialog-buttons><a class=inline-button href=#top>Go to top</a> <a class="inline-button colored" href=https://github.com/AgustinRamiroDiaz/personalpage/issues>File an issue</a></div><footer id=site-footer></footer>